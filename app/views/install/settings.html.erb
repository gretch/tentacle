<%= render :partial => "admin/tabs" %>

<% if request.post? -%>
<div class="notice">Your settings have been saved.</div>
<% end -%>

<div id="commands">
<% form_tag settings_path do -%>
  <fieldset>
    <legend>Password Settings</legend>
    <p>This setting determines how the passwords are stored in the database, and how they are written to the svn password file.  Changing this setting will require all users to reset their passwords.</p>
    <p>
      <label for="settings_authentication_scheme">Authentication Scheme</label>
      <%= select_tag :settings_authentication_scheme, options_for_select(%w(basic md5 plain), Tentacle.authentication_scheme),
           :name => 'settings[authentication_scheme]' %>
    </p>
    <p>
      <label for="settings_authentication_realm">Authentication Realm</label>
      <%= text_field_tag :settings_authentication_realm, params[:settings][:authentication_realm] || Tentacle.authentication_realm,
            :size => 40, :name => 'settings[authentication_realm]' %>
    </p>
  </fieldset>
  
  <p class="command">
    <label for="settings_mail_type">Mail Server Type</label>
    <select name="settings[mail_type]" id="settings-mail-type" style="width:200px">
      <%= options_for_select([%w(SMTP smtp), 'sendmail'], params[:settings][:mail_type] || Tentacle.mail_type) %>
    </select>
  </p>
  
  <fieldset id="mail-smtp"<%= %( style="display:none") if (params[:settings][:mail_type] || Tentacle.mail_type) == 'sendmail' %>>
    <legend>SMTP Mail Settings</legend>
    <p>
      <label for="settings_mail_address">Address</label>
      <%= text_field_tag :settings_mail_address, params[:settings][:smtp_settings][:address] || Tentacle.smtp_settings[:address] || :localhost, 
        :size => 40, :name => 'settings[smtp_settings][address]' %>
    </p>
    <p>
      <label for="settings_mail_port">Port</label>
      <%= text_field_tag :settings_mail_port, params[:settings][:smtp_settings][:port] || Tentacle.smtp_settings[:port] || 25, 
        :size => 40, :name => 'settings[smtp_settings][port]' %>
    </p>
    <p>
      <label for="settings_mail_domain">Domain</label>
      <%= text_field_tag :settings_mail_domain, params[:settings][:smtp_settings][:domain] || Tentacle.smtp_settings[:domain], 
        :size => 40, :name => 'settings[smtp_settings][domain]' %>
    </p>
    <p>
      <label for="settings_mail_user_name">User Name</label>
      <%= text_field_tag :settings_mail_user_name, params[:settings][:smtp_settings][:user_name] || Tentacle.smtp_settings[:user_name], 
        :size => 40, :name => 'settings[smtp_settings][user_name]' %>
    </p>
    <p>
      <label for="settings_mail_password">Password</label>
      <%= password_field_tag :settings_mail_password, params[:settings][:smtp_settings][:password] || Tentacle.smtp_settings[:password], 
        :size => 40, :name => 'settings[smtp_settings][password]' %>
    </p>
    <p>
      <label for="settings_mail_authentication">Authentication</label>
      <%= text_field_tag :settings_mail_authentication, params[:settings][:smtp_settings][:authentication] || Tentacle.smtp_settings[:authentication] || :plain, 
        :size => 40, :name => 'settings[smtp_settings][authentication]' %>
    </p>
  </fieldset>

  <fieldset id="mail-sendmail"<%= %( style="display:none") if (params[:settings][:mail_type] || Tentacle.mail_type) != 'sendmail' %>>
    <legend>Sendmail Settings</legend>
    <p>
      <label for="settings_mail_location">Location</label>
      <%= text_field_tag :settings_mail_location, params[:settings][:sendmail_settings][:location] || Tentacle.sendmail_settings[:location] || '/usr/sbin/sendmail', 
        :size => 40, :name => 'settings[sendmail_settings][location]' %>
    </p>
    <p>
      <label for="settings_mail_arguments">Command Arguments</label>
      <%= text_field_tag :settings_mail_arguments, params[:settings][:sendmail_settings][:arguments] || Tentacle.sendmail_settings[:arguments], 
        :size => 40, :name => 'settings[sendmail_settings][arguments]' %>
    </p>
  </fieldset>
  <p class="btns"><%= submit_image 'save.png' %></p>
<% end -%>
</div>
